 SELECT 
    MONTHNAME(fecha_base.fecha) AS mes,
    CAST(MONTH(fecha_base.fecha) AS CHAR) AS mesNum,
    COALESCE(solicitudes.count_solicitudes, 0) AS numSolicitudes,
    COALESCE(movimientos.sum_monto, 0) AS monto,
    YEAR(fecha_base.fecha) AS anio
FROM (
    -- Generamos todas las combinaciones de meses y años que necesitamos
    SELECT DISTINCT 
        DATE(CONCAT(anio.y, '-', mes.m, '-01')) AS fecha
    FROM 
        (SELECT $anioAnterior AS y UNION ALL SELECT $anioActual) anio
    CROSS JOIN 
        (SELECT 1 AS m UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 
         UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 
         UNION ALL SELECT 9 UNION ALL SELECT 10 UNION ALL SELECT 11 UNION ALL SELECT 12) mes
) AS fecha_base
-- Contamos solicitudes por mes/año
LEFT JOIN (
    SELECT 
        YEAR(s.fecha_inicio) AS anio,
        MONTH(s.fecha_inicio) AS mes,
        COUNT(*) AS count_solicitudes
    FROM solicitud s
    WHERE 
        YEAR(s.fecha_inicio) IN ($anios)
        AND s.id_estatus_solicitud IN ($estatus)
        AND NOT EXISTS (
            SELECT 1
            FROM evento_solicitud es
            WHERE es.id_solicitud = s.id_solicitud
              AND es.descripcion LIKE '%Lost%'
        )
    GROUP BY YEAR(s.fecha_inicio), MONTH(s.fecha_inicio)
) AS solicitudes 
    ON YEAR(fecha_base.fecha) = solicitudes.anio 
    AND MONTH(fecha_base.fecha) = solicitudes.mes
-- Sumamos montos de movimientos por mes/año (relacionados con esas solicitudes)
LEFT JOIN (
    SELECT 
        YEAR(m.fecha) AS anio,
        MONTH(m.fecha) AS mes,
        SUM(m.monto) AS sum_monto
    FROM movimiento m
    INNER JOIN solicitud s ON s.id_solicitud = m.id_solicitud
    WHERE 
        YEAR(m.fecha) IN ($anios)
        AND s.id_estatus_solicitud IN ($estatus)
        AND NOT EXISTS (
            SELECT 1
            FROM evento_solicitud es
            WHERE es.id_solicitud = s.id_solicitud
              AND es.descripcion LIKE '%Lost%'
        )
    GROUP BY YEAR(m.fecha), MONTH(m.fecha)
) AS movimientos 
    ON YEAR(fecha_base.fecha) = movimientos.anio 
    AND MONTH(fecha_base.fecha) = movimientos.mes
ORDER BY anio DESC, MONTH(fecha_base.fecha) ASC