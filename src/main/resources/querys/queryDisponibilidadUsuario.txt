SELECT
    DATE_FORMAT(d.fecha, '%Y-%m-%d') AS fecha,
    d.hora,
    d.tipo,
    u.id_usuario AS solicitud,
    u.id_usuario AS usuario,
    u.nombre      AS nombreUsuario,
    u.color,
    d.zona_horaria
FROM disponibilidad_usuario d
JOIN usuario u
    ON u.id_usuario = d.id_usuario
    $joinEstado
LEFT JOIN evento_solicitud e
   ON e.fecha_schedule   = d.fecha
   AND e.hora_schedule    = d.hora
   AND e.tipo_schedule    = d.tipo
   AND e.usuario_schedule = u.id_usuario
   AND e.estatus_schedule = 1
   AND e.fecha_schedule  >= :inicioSemana
   AND e.fecha_schedule  <= :finSemana
WHERE d.fecha >= :inicioSemana
  AND d.fecha <= :finSemana
  AND u.estatus != 4
  AND e.id_evento IS NULL
  $andsAdicionales
GROUP BY
    d.fecha,
    d.hora,
    d.tipo,
    u.id_usuario,
    u.nombre,
    u.color,
    d.zona_horaria;